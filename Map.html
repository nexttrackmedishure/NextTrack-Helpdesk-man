<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>World Map ‚Äì Dark Mode Ready (SEA Focus)</title>
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    :root {
      color-scheme: light dark;
      --bg: #0b0d10;
      --fg: #e6e6e6;
      --panel: #12161b;
      --border: #2a313a;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--fg);
    }
    .app {
      height: 100%;
      display: grid;
      grid-template-rows: auto 1fr;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: .8rem 1rem;
      background: var(--panel);
      border-bottom: 1px solid var(--border);
    }
    header h1 { font-size: clamp(1rem, 2.2vw, 1.15rem); margin: 0; font-weight: 600; }
    .controls { display: flex; gap: .5rem; align-items: center; }
    button, select {
      background: transparent;
      color: var(--fg);
      border: 1px solid var(--border);
      padding: .45rem .7rem;
      border-radius: 12px;
      cursor: pointer;
    }
    button:hover, select:hover { border-color: #3b4552; }

    #map { height: 100%; width: 100%; }

    /* Tweak default Leaflet control look for dark UI */
    .leaflet-control-container .leaflet-control { 
      background: rgba(18,22,27,.85);
      color: var(--fg);
      border: 1px solid var(--border);
      backdrop-filter: blur(6px);
      border-radius: 12px;
    }
    .leaflet-control a { color: var(--fg); }
    .leaflet-bar a, .leaflet-bar a:hover { color: var(--fg); border-bottom-color: var(--border); }
    .leaflet-bar a:hover { background: rgba(255,255,255,.06); }
    .leaflet-popup-content-wrapper, .leaflet-popup-tip {
      background: #0f1318; color: var(--fg); border: 1px solid var(--border);
    }

    /* Small badge to show current theme */
    .badge { font-size: .8rem; opacity: .8; padding: .25rem .5rem; border: 1px solid var(--border); border-radius: 999px; }

    /* Responsive: keep controls from overlapping on narrow screens */
    @media (max-width: 480px) { header { flex-wrap: wrap; } }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>World Map ¬∑ Dark Mode Compatible</h1>
      <div class="controls">
        <span id="themeBadge" class="badge" title="Current basemap theme">Dark</span>
        <select id="themeSelect" aria-label="Basemap theme">
          <option value="dark" selected>Dark (CartoDB Dark Matter)</option>
          <option value="light">Light (CartoDB Positron)</option>
          <option value="satellite">Satellite (Esri)</option>
          <option value="terrain">Terrain (Stamen)</option>
        </select>
        <button id="locateBtn" title="Go to my location">üìç Locate</button>
        <button id="resetBtn" title="Reset view">‚Ü∫ Reset</button>
      </div>
    </header>
    <div id="map" role="region" aria-label="Interactive world map"></div>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script>
    // --- Base map layers (no API key needed) ---
    const layers = {
      dark: L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        maxZoom: 20
      }),
      light: L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OSM & CARTO',
        maxZoom: 20
      }),
      satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
        maxZoom: 20
      }),
      terrain: L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/terrain/{z}/{x}/{y}.jpg', {
        attribution: 'Map tiles by Stamen Design, under CC BY 3.0. Data by OSM',
        maxZoom: 17
      })
    };

    // --- Map init ---
    const map = L.map('map', { zoomControl: true, worldCopyJump: true });

    // Bounding box for Southeast Asia
    const seaBounds = L.latLngBounds(
      [-11.0, 92.0],   // southwest corner (near Indonesia / Andaman Sea)
      [23.0, 135.0]    // northeast corner (above Taiwan / Philippines)
    );

    // Start zoomed to Southeast Asia
    map.fitBounds(seaBounds);

    let active = layers.dark.addTo(map);

    // Scale control
    L.control.scale({ metric: true, imperial: false, position: 'bottomleft' }).addTo(map);

    // Keep map constrained inside world bounds
    const southWest = L.latLng(-85, -180), northEast = L.latLng(85, 180);
    const bounds = L.latLngBounds(southWest, northEast);
    map.setMaxBounds(bounds);
    map.on('drag', function() { map.panInsideBounds(bounds, { animate: false }); });

    // Theme selector logic
    const select = document.getElementById('themeSelect');
    const badge = document.getElementById('themeBadge');

    function setTheme(name) {
      if (active) map.removeLayer(active);
      active = layers[name];
      active.addTo(map);
      badge.textContent = name.charAt(0).toUpperCase() + name.slice(1);
    }

    // Respect system prefers-color-scheme on load
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (!prefersDark) { select.value = 'light'; setTheme('light'); }

    select.addEventListener('change', (e) => setTheme(e.target.value));

    // Geolocate button
    document.getElementById('locateBtn').addEventListener('click', () => {
      if (!navigator.geolocation) return alert('Geolocation not supported');
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const { latitude, longitude } = pos.coords;
          map.flyTo([latitude, longitude], 10, { duration: 1.2 });
          L.marker([latitude, longitude]).addTo(map).bindPopup('You are here').openPopup();
        },
        (err) => alert('Location failed: ' + err.message),
        { enableHighAccuracy: true, timeout: 8000, maximumAge: 0 }
      );
    });

    // Reset view button (back to Southeast Asia)
    document.getElementById('resetBtn').addEventListener('click', () => {
      map.fitBounds(seaBounds);
    });

    // Example markers
    const examples = [
      { name: 'Manila', latlng: [14.5995, 120.9842] },
      { name: 'Bangkok', latlng: [13.7563, 100.5018] },
      { name: 'Jakarta', latlng: [-6.2088, 106.8456] },
      { name: 'Hanoi', latlng: [21.0278, 105.8342] }
    ];
    examples.forEach(p => L.circleMarker(p.latlng, { radius: 6, weight: 2, opacity: .9 }).addTo(map).bindPopup(p.name));
  </script>
</body>
</html>